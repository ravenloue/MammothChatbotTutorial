<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viweport" content="width=device-width, initial-scale=1">
    <title>Basic Chatbot</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" 
        rel="stylesheet"
		    integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
        crossorigin="anonymous">
  </head>

  <body>
    <h1>Welcome to Chat</h1>
	  <p id="response"></p>
    <p id="question">What is your name?</p>
    
    
    <form id="answerForm">
      <div class="input-group">
      <input placeholder="Enter answer here" type="text" id="answer" value=""
             class="form-control-sm" aria-label="Enter answer here">
      <button type="submit" class="btn btn-info">Submit</button>
    </form>
    </div>
    <form id="birthdayForm" style="display: none;">
	    <div class="input-group">
        <select name="months" id="months" aria-label="Month">
        <option value="January">January</option>
	    	<option value="February">February</option>
      	<option value="March">March</option>
        <option value="April">April</option>
        <option value="May">May</option>
        <option value="June">June</option>
        <option value="July">July</option>
        <option value="August">August</option>
        <option value="September">September</option>
        <option value="October">October</option>
        <option value="November">November</option>
        <option value="December">December</option>
      </select>
      	    
      <input placeholder="Enter day" type="number" id="birthdayAnswer" value=""
             min="1" max="31" class="form-control-sm" aria-label="Day">
      <button type="submit" class="btn btn-info">Submit</button>
      </div>
    </form>

    <form id="holidayForm" style="display: none;">
	    <div class="input-group">
      <select name="holidays" id="holidays" aria-label="Select Holiday">
        <option value="Chinese New Year">Chinese New Year</option>
		    <option value="Christmas">Christmas</option>
        <option value="Halloween">Halloween</option>
        <option value="Hannukah">Hannukah</option>
        <option value="Kwanza">Kwanza</option>
        <option value="New Year">New Year</option>
        <option value="Ramadan">Ramadan</option>
       </select>
       <button type="submit" class="btn btn-info">Submit</button>
	    </div>
    </form>

    <button id="restartButton" style="display: none;"
            class="btn btn-success">Restart</button>


<script type="text/javascript">
var questionNumber = 0;

const response = document.getElementById("response");
const answerForm = document.getElementById("answerForm");
const birthdayForm = document.getElementById("birthdayForm");
const holidayForm = document.getElementById("holidayForm");
const restartButton = document.getElementById("restartButton");

/** 
 * Returns the difference between the user's birthday and the current date
 * by converting milliseconds to days using the following formula
 * 
 * 86,400,000 = 1000ms * 60sec * 60min * 24hrs
 */
function calculateDifferenceInDays(date) {

  return Math.ceil((date - new Date()) / 86400000 );  

  };

/** 
 * CalculateNextBirthday takes the current year along with the information submitted
 * by the user to determine the date of the user's next birthday in order to determine 
 * how many days until the user's next birthday.
 */
function calculateNextBirthday(){
  
  let birthdayYear = new Date().getFullYear();
  const selectedBirthdayMonthElement = document.getElementById("months");
  const birthdayMonth = selectedBirthdayMonthElement.selectedIndex + 1;
  const birthdayDay = document.getElementById("birthdayAnswer").value;
  let birthdayDate = new Date(birthdayYear+"-"+birthdayMonth+"-"+birthdayDay);
  const birthdayAnswer = document.getElementById("months").value + " " + document.getElementById("birthdayAnswer").value;

  // If the birthday has already passed, add one to the current year
  if ( new Date()> birthdayDate){
    birthdayYear = birthdayYear + 1;
    birthdayDate = new Date(birthdayYear + "-" + birthdayMonth + "-" + birthdayDay);
  }

  response.innerText = "You said your birthday is on "+birthdayAnswer+". Your next birthday is in "
                       +calculateDifferenceInDays(birthdayDate)+" days.";
  };

/**
 * CalculateNextHoliday takes the current year along with the information
 * selected by the user to determine the date of the user's favorite holiday
 * in order to determine how many days there are until the next occurance
 */
function calculateNextHoliday(){
  const holidays = document.getElementById("holidays");
  const favorityHoliday = holidays.options[holidays.selectedIndex].value;
  let month = 1;
  let day = 1; 

  switch(favorityHoliday){
    case "Chinese New Year":
      month = 1;
      day   = 22;
      break;
    case "Christmas":
      month = 12;
      day   = 25;
      break;
    case "Halloween":
      month = 10;
      day   = 31;
      break;
    case "Hannukah":
      month = 12;
      day   = 7;
      break;
    case "Kwanza":
      month = 12;
      day   = 26;
      break;
    case "New Year":
      month = 1;
      day   = 1;
      break;
    case "Ramadan":
      month = 3;
      day   = 26;
      break;
    default:
      month = 1;
      day   = 1;
  }
  let year = new Date().getFullYear();
  let holidayDate = new Date(year+"-"+month+"-"+day);

  // If the holiday has already passed, add one to the current year
  if( new Date() > holidayDate){
    year = year+1;
    holidayDate = new Date(year + "-" + month + "-" + day);
  }

  response.innerText = "Your favorite holiday, "+favorityHoliday+", is only "
                       +calculateDifferenceInDays(holidayDate)+" days away.";
  };
/**
 * runChatbot() is the main function which controls the order of execution for
 * the browser chatbot through the use of a series of if/else statements
 */
function runChatbot(){

  event.preventDefault();

  const answer = document.getElementById("answer");
  const question = document.getElementById("question");
  
  // The questionNumber determines which stage the chatbot program runs next
  if(questionNumber === -1){
    question.innerText = "What is your name?";
    response.innerText = "";
    answer.value="";
    answerForm.style.display="block";
  }else if(questionNumber === 0){
    response.innerText = "You said your name is "+answer.value+".";
    question.innerText = "Hello "+answer.value+". When is your birthday?";

    birthdayForm.style.display="block";
    answerForm.style.display="none";

  }else if(questionNumber === 1){
    calculateNextBirthday();
    question.innerText = "What is your favorite holiday?";

    birthdayForm.style.display = "none";
    holidayForm.style.display = "block";

  }else if(questionNumber === 2){
    calculateNextHoliday();    
    question.innerText = "How old are you?";
    
    holidayForm.style.display = "none";
    answerForm.style.display = "block";
    answer.value="";
  }else if(questionNumber === 3){
    
    const birthYear = new Date().getFullYear() - answer.value;
        
    response.innerText = "Based on your age, you were born in "+birthYear+".";
    question.innerText = "Thanks for playing!";
    answerForm.style.display = "none";
    restartButton.style.display = "block";
  }

  // Enables the chatbot to move onto the next function in the if/else clause
  questionNumber++;

};



answerForm.addEventListener("submit", function(event){
  runChatbot();
});

birthdayForm.addEventListener("submit", function(event){
  runChatbot();
});

holidayForm.addEventListener("submit", function(event){
  runChatbot();
});
restartButton.addEventListener("click", function(event){
  questionNumber = -1;
  runChatbot();
  restartButton.style.display = "none";
});
</script></body><html>